# Euler 245 - Coresilience
#
# Just gonna brute force this one over the course of an hour or two
#
# Or 300 apparently

from Primes import MakePrimeList
import json

class CoresilienceUnitFractionFinder:
    def __init__(self, nMax, chunkSize):
        self.N = nMax
        self.chunkSize = chunkSize
        self.chunk = 0
        self.primes = MakePrimeList(int(nMax**0.5)+1)
        self.solutions = set()
        
    def saveString(self):
        obj = {}
        obj['N'] = self.N
        obj['chunkSize'] = self.chunkSize
        obj['chunk'] = self.chunk
        obj['solutions'] = list(self.solutions)
        obj['solutions'].sort()
        return json.dumps(obj)
        
    def importString(self, jsonStr):
        obj = json.loads(jsonStr)
        self.N = obj['N']
        self.chunkSize = obj['chunkSize']
        self.chunk = obj['chunk']
        self.solutions = set(obj['solutions'])
    
    def _solve(self, N):
        while self.chunk * self.chunkSize <= N:
            offset = self.chunk * self.chunkSize
            phi = list(range(offset, offset + self.chunkSize))
            f = list(range(offset, offset + self.chunkSize))
            for p in self.primes:
                if p*p >= (self.chunk+1)*self.chunkSize: break
                nStart = (offset//p)*p
                if nStart < offset:
                    nStart += p
                ixStart = nStart - offset
                nEnd = offset + self.chunkSize - 1
                nEnd = min(N, nEnd)
                ixEnd = nEnd - offset
                for ix in range(ixStart, ixEnd + 1, p):
                    while f[ix] % p == 0 and f[ix] != 0:
                        f[ix] //= p
                    phi[ix] //= p
                    phi[ix] *= p-1
            for ix in range(ixEnd+1):
                n = offset + ix
                if f[ix] > 1:
                    phi[ix] //= f[ix]
                    phi[ix] *= f[ix]-1
                #print n, f[ix], phi[ix]
                if n > 1 and (n-1)%(n-phi[ix]) == 0 and phi[ix] < n-1:
                    self.solutions.add(n)
            
            print 'Chunk Number: {0} | Values: {1}-{2} | Num Solutions: {3} | Sum: {4}'.format(self.chunk, offset, offset + self.chunkSize - 1, len(self.solutions), sum(self.solutions))
            if self.chunk%1000 == 0:
                self.save()
            self.chunk += 1
                    
    def solve(self, N):
        self._solve(N)
        self.save()
        s = sum(self.solutions)
        print s
        
    def save(self):
       with open('DropBox/EulerProject/Euler245SaveFile.txt', 'w') as f:
           f.write(self.saveString())
    
    def resumeFromSave(self):
        with open('DropBox/EulerProject/Euler245SaveFile.txt', 'r') as f:
            self.importString(f.read())
            self.primes = MakePrimeList(int(self.N**0.5)+1)
            self.solve(self.N)
        
saveString = '{"chunk": 42981, "solutions": [15, 85, 255, 259, 391, 589, 1111, 3193, 4171, 4369, 12361, 17473, 21845, 25429, 28243, 47989, 52537, 65535, 65641, 68377, 83767, 91759, 100777, 120019, 144097, 167743, 186367, 268321, 286357, 291919, 316171, 327937, 335923, 346063, 353029, 360301, 404797, 406867, 524851, 531721, 558013, 563767, 633727, 705667, 738607, 910489, 970141, 1013539, 1080769, 1093987, 1184233, 1185421, 1223869, 1233823, 1261807, 1264693, 1455889, 1487371, 1529641, 1574383, 1612381, 1617379, 1657531, 1793689, 2016379, 2095087, 2130871, 2214031, 2299459, 2500681, 2553709, 2609689, 2617963, 2763697, 3047521, 3146677, 3397651, 3514603, 3539017, 3817309, 3820909, 3902867, 3961219, 4078927, 4186993, 4197901, 4499707, 4552411, 4935883, 4975687, 5103841, 5299351, 5574929, 5729257, 5829877, 5864581, 6017299, 6236401, 6802531, 6856609, 8759011, 9059233, 9203377, 9301603, 9305311, 9526747, 9536899, 9583279, 9782347, 9900217, 10089997, 10093049, 10517557, 11000323, 11024077, 11045779, 11866609, 13209907, 13577869, 13881841, 14032033, 14678161, 15030289, 15558607, 15567163, 15687751, 15829087, 16843009, 17093077, 17603161, 17632421, 17671711, 17910091, 18196231, 18538087, 18627709, 18647023, 19103323, 19200091, 19271053, 19756171, 19893343, 20014411, 20057701, 20794801, 21102061, 21249607, 21429157, 21707869, 21745501, 21961201, 22030681, 22129969, 22746127, 23165143, 24853789, 24980677, 25003777, 25204327, 26687893, 27874645, 28035967, 28204489, 28746559, 29029873, 29087939, 29388487, 29788141, 29814247, 30401689, 30444457, 31296757, 31440397, 31784719, 31975327, 32041129, 33968107, 34245121, 38213761, 41181013, 42151591, 42816901, 43085617, 43409983, 43932181, 45144067, 45883741, 46183099, 48079147, 49063249, 49087417, 50979559, 51764917, 52036447, 52158877, 55762723, 55815439, 58643083, 61216429, 61411351, 61956121, 62256349, 63047359, 63516727, 64160401, 64221331, 64827379, 65493499, 66450931, 67305811, 68927821, 70313923, 73196047, 73381081, 74264821, 74399971, 75720559, 76033777, 77754037, 77826097, 79019221, 79154221, 79367947, 79692331, 80604499, 83157367, 83623935, 86560861, 86767909, 90582421, 92229763, 96798577, 96835159, 97066813, 98385601, 99095539, 99778069, 101412319, 102844723, 104744641, 104851363, 104912617, 104954779, 106359961, 107640121, 107688127, 108197489, 109018579, 109198093, 109819849, 110683327, 111474037, 111985903, 112026349, 112286047, 112372501, 113552599, 117889591, 118023043, 127408711, 127466359, 128901613, 129709093, 130371133, 130577521, 130736299, 130979983, 131206729, 134437549, 134712553, 136246111, 136451173, 137122861, 137389477, 139255213, 139573561, 140314381, 140402599, 140411461, 140440411, 142052917, 146131969, 146382001, 153229861, 153701941, 154642567, 155083837, 158155243, 158315389, 161966911, 164810641, 165250669, 166875103, 167639629, 171639889, 172189309, 175585777, 175976137, 178874209, 180237307, 181594681, 184912177, 185402491, 185518471, 185943757, 187202299, 188819779, 189668443, 190545637, 191435329, 193443979, 193934581, 196213837, 197406949, 205037869, 206731201, 207807097, 209690311, 210136477, 218164981, 220022167, 220756927, 220846627, 229212031, 231870073, 232951531, 235581727, 237774727, 240235843, 241347289, 243987409, 244275547, 244304341, 247105147, 251834161, 253103449, 255311599, 256678267, 256755703, 256923109, 258965851, 261040207, 263226289, 268019137, 270004099, 275035729, 276325099, 278355379, 279209323, 286114253, 286331153, 292710991, 293836981, 294789097, 295629331, 296873833, 298200271, 299281351, 302443231, 309616357, 309933427, 311068759, 319071409, 320328031, 325833889, 328985791, 330937153, 331544947, 332641597, 339642367, 340886107, 341540239, 343288111, 343490701, 349234339, 351012091, 354706951, 354963001, 357275839, 358028743, 360849301, 361941091, 367858147, 369600619, 370839253, 376070293, 381713581, 383143141, 384849571, 389743987, 394613017, 397129081, 397567507, 404471887, 407403949, 408767143, 410854711, 412141237, 412302073, 416131087, 417265207, 422438251, 422502187, 430169083, 430240441, 430460707, 432960457, 433243399, 437825767, 438869029, 439554361, 440620951, 442219441, 442259383, 443674369, 448158127, 450040501, 450730099, 465664531, 468804673, 469361371, 472535857, 474225601, 474378997, 484743991, 496649077, 497991397, 505796773, 509980693, 514663717, 517646179, 520196161, 520313341, 520374541, 526190839, 526433389, 534717871, 538526929, 542197531, 546775609, 550714621, 551080093, 551669017, 564243079, 564713113, 578230969, 579511813, 579657607, 586606441, 591618019, 602197933, 606593443, 619082293, 625086181, 626499541, 633615991, 635619037, 646798351, 649981597, 652309321, 655321549, 657496687, 660532687, 660975739, 661722277, 663718771, 666853909, 672379303, 674632687, 680431189, 694858711, 697167787, 699709123, 708203611, 710619979, 712084759, 723874321, 726174931, 733095283, 736017757, 737428117, 741829267, 744499159, 753503581, 754400011, 756484357, 756898897, 758600851, 761229121, 762324499, 766059247, 767828353, 769239967, 775522723, 779044801, 783216739, 789181831, 807222667, 809202577, 817178161, 820902889, 821310331, 826267963, 831954757, 832409419, 835150237, 842585071, 846990817, 847486399, 848983591, 849969751, 862138957, 864374701, 874712191, 877734523, 880417357, 883482529, 884229331, 890538511, 891539833, 892105891, 894813817, 896495071, 901119301, 902362819, 904244113, 905169037, 907078771, 911871979, 913748413, 914408149, 918213739, 925003561, 928682959, 932065447, 936733657, 943666807, 944496361, 949473331, 955226497, 956958043, 961075039, 976038277, 984344971, 986444083, 986573101, 995756647, 1008616207, 1012816309, 1013071669, 1013458477, 1017329377, 1020518407, 1029122203, 1029352837, 1037911729, 1038710809, 1039183681, 1042904857, 1044365557, 1047997651, 1048712449, 1049178901, 1056550393, 1061851171, 1069261051, 1069499479, 1070169589, 1073879887, 1088670439, 1094246437, 1096212937, 1100678221, 1105251349, 1106941117, 1112405197, 1115319241, 1117441057, 1117785397, 1125845491, 1126448443, 1129151983, 1134644449, 1134882139, 1145444353, 1151916349, 1158778057, 1165351753, 1183783981, 1189377391, 1190672887, 1192140661, 1192448209, 1194756457, 1200101641, 1207954831, 1210586329, 1232720941, 1236737239, 1239694693, 1249433257, 1252475239, 1258976767, 1260711139, 1270287409, 1272281497, 1289254909, 1294677757, 1296331051, 1297206259, 1297333759, 1298559523, 1305650767, 1310643181, 1313997661, 1317735049, 1324862449, 1328713279, 1333202359, 1340452231, 1341229117, 1341726583, 1342472629, 1351618087, 1361225641, 1365446857, 1368873697, 1374216043, 1382779633, 1404301237, 1412391007, 1415281729, 1418626837, 1431655765, 1432075387, 1432148407, 1436336743, 1438910509, 1440861889, 1443702079, 1445912389, 1452068491, 1452216361, 1458488839, 1459252237, 1462502533, 1470841201, 1476638437, 1477455211, 1486728589, 1505005399, 1505194237, 1508507017, 1510264891, 1514482987, 1515169759, 1521989041, 1522198651, 1526971027, 1528485097, 1537170181, 1538805391, 1561290277, 1567827007, 1569949123, 1571472031, 1578592471, 1588507021, 1592982481, 1601667097, 1601953369, 1610173057, 1617776617, 1622468821, 1627658509, 1629687571, 1645057651, 1647616279, 1658846767, 1659674101, 1668955261, 1669537741, 1671743767, 1676121679, 1685151499, 1685304013, 1700865583, 1703453077, 1718542849, 1724488231, 1729110763, 1729292503, 1732054507, 1740751681, 1752270661, 1772040601, 1773826627, 1788152143, 1789754377, 1793093551, 1800601267, 1807007827, 1807155169, 1807279987, 1814083177, 1818650527, 1826158567, 1826502043, 1827045229, 1829168041, 1837982359, 1838647999, 1839639937, 1850467081, 1853686969, 1866895999, 1867642477, 1867926127, 1872507631, 1872832711, 1875068917, 1887320989, 1896214009, 1912416871, 1925094289, 1926764911, 1928194393, 1935535891, 1937145547, 1939428499, 1943100517, 1961441023, 1964142181, 1965100369, 1965814969, 1974301447, 1981406653, 1985804419, 1986049171, 1987541107, 2000858407, 2011664047, 2012833597, 2025541129, 2034597541, 2049668557, 2055063469, 2061652423, 2070642991, 2071000543, 2079182029, 2087983327, 2103971647, 2119885897, 2127338383, 2132258287, 2137958941, 2139142237, 2145219397, 2148354391, 2149875499, 2150939803, 2171447149, 2173800919, 2183666647, 2211280051, 2229267559, 2233435969, 2237937157, 2244345403, 2260188373, 2284429681, 2301711721, 2310733237, 2335141969, 2336718973, 2365389823, 2376028591, 2386537357, 2387925427, 2395558777, 2399627431, 2423417851, 2424743077, 2451660973, 2458626031, 2466214453, 2474658721, 2475932299, 2476332223, 2489482627, 2499336799, 2500537771, 2509457287, 2510067433, 2518153327, 2522580061, 2525210239, 2529245479, 2532630127, 2546875039, 2550763219, 2595948151, 2599186873, 2613591859, 2637572731, 2663517511, 2672065579, 2690883241, 2693731981, 2698258357, 2701312609, 2706408337, 2716199149, 2718742657, 2728929019, 2750155267, 2765381737, 2767503259, 2769193321, 2781455647, 2781758587, 2787238273, 2787460171, 2800548967, 2803452529, 2810378353, 2825412301, 2833939957, 2834586301, 2844796321, 2848900807, 2860879207, 2870200579, 2895016153, 2910030163, 2924446513, 2934445387, 2955547813, 2958359917, 2963950753, 2964993079, 2966690203, 2966828341, 2979280201, 3000642109, 3013520071, 3026756881, 3035153281, 3037559071, 3047050579, 3049126183, 3059200489, 3061418557, 3070909201, 3088253551, 3101364841, 3103628233, 3110612053, 3122829937, 3132559327, 3144794251, 3144932743, 3150481099, 3154933909, 3165553579, 3184719253, 3195664837, 3202914901, 3210325957, 3214580449, 3221635327, 3224008759, 3225219799, 3226593151, 3229524877, 3256078711, 3263860111, 3269237833, 3277533199, 3278887831, 3289107721, 3295700377, 3325209763, 3330979273, 3364243117, 3370462609, 3376818031, 3378047737, 3378809281, 3387203653, 3403316551, 3404353891, 3404737519, 3409523287, 3415005551, 3419620153, 3422779411, 3423145679, 3424399789, 3427974721, 3429453679, 3451917379, 3455139931, 3460192891, 3465640309, 3475496137, 3485524927, 3497723797, 3523322797, 3527185747, 3572763169, 3578043211, 3580290841, 3586819081, 3591243223, 3602202997, 3612964801, 3633210877, 3653037697, 3677282311, 3682853737, 3687988921, 3691683409, 3692914681, 3714551959, 3727425001, 3754486201, 3769918051, 3813305131, 3819228583, 3842843419, 3843011569, 3854034409, 3858815101, 3859398607, 3872359471, 3878205649, 3887581699, 3888131827, 3896786989, 3910076017, 3911425249, 3923568247, 3923638231, 3954328951, 3957377119, 3974237653, 3975822661, 3976407901, 3977486563, 3985479709, 4003310923, 4013984641, 4029723097, 4030454821, 4074838687, 4110730219, 4123514821, 4147324231, 4157657041, 4158910417, 4186680811, 4193903551, 4194322771, 4194796621, 4201211059, 4224678277, 4229056003, 4239543037, 4248462451, 4256507137, 4258256971, 4258682611, 4261681999, 4266194341, 4271646919, 4275165883, 4283452417, 4291824391, 4294967295, 4301776117, 4302091039, 4306552807, 4319663947, 4333023157, 4388627839, 4391685211, 4395770347, 4428753631, 4431524359, 4432755097, 4437189121, 4450190377, 4453857607, 4481797153, 4506263761, 4509994939, 4511134993, 4514905921, 4540485757, 4575449737, 4578042127, 4588783681, 4591961089, 4599398857, 4639523527, 4648305169, 4661608069, 4676392579, 4689130909, 4694855413, 4697617723, 4702061839, 4713840097, 4743495313, 4749381157, 4751102227, 4787484547, 4807210801, 4844449723, 4851699889, 4871271679, 4874927503, 4884338551, 4897795249, 4907237869, 4927043137, 4943554771, 4945648009, 4952169457, 4972677607, 4975000447, 4977243517, 4983615337, 4988627041, 4994598127, 5044656739, 5056289419, 5061799003, 5069053219, 5069231779, 5093868721, 5096187829, 5117457361, 5179703341, 5187259579, 5229335317, 5235814723, 5239018849, 5240239087, 5256718477, 5267427331, 5270796301, 5279647267, 5294585551, 5294588437, 5303589019, 5313446533, 5325560371, 5333164009, 5344771099, 5352112741, 5353318699, 5360033533, 5387655619, 5389086319, 5395075981, 5402961373, 5412535519, 5413668439, 5416606183, 5453784481, 5458707451, 5473526647, 5480754343, 5493427897, 5500515277, 5507390731, 5541118987, 5627296501, 5636346601, 5636506639, 5645862517, 5649920449, 5650040299, 5658077209, 5658999781, 5686045831, 5689848217, 5698458949, 5706395557, 5717211037, 5717676823, 5725366597, 5727529861, 5741044663, 5742266269, 5743646791, 5761912027, 5771469019, 5802997861, 5804054257, 5819967973, 5823288871, 5827781767, 5829701197, 5830754287, 5832299479, 5836677211, 5846990449, 5856060757, 5870715847, 5893114111, 5937123991, 5941898689, 5943940999, 5960386363, 5982543337, 6028088179, 6033535159, 6040236217, 6069792811, 6108482917, 6121734529, 6123823987, 6175014133, 6215472199, 6222857467, 6225397699, 6243800791, 6258290557, 6260416933, 6260823157, 6260894023, 6269892709, 6281170123, 6288800953, 6293477779, 6317101309, 6317105461, 6319765561, 6320852701, 6341431099, 6341538991, 6346826131, 6360703861, 6368977939, 6372554833, 6382809733, 6388345111, 6389907187, 6420180469, 6423577717, 6438317461, 6477330037, 6486843127, 6488020081, 6490582591, 6494094517, 6517460461, 6527382583, 6542701771, 6548846377, 6563906581, 6565814821, 6569845801, 6574047307, 6597107521, 6605870629, 6624164941, 6626783263, 6640128769, 6640831237, 6648009523, 6663937561, 6666255457, 6686300839, 6689721439, 6710359657, 6723352807, 6736095409, 6740896429, 6745064791, 6746357767, 6747372271, 6750310351, 6761186947, 6799138501, 6800670661, 6811669957, 6816370837, 6820418623, 6826786717, 6867487111, 6881755189, 6905695009, 6917963287, 6922859737, 6959924581, 6983038651, 6986626879, 7001398561, 7046917807, 7051272187, 7051675999, 7055838019, 7063469167, 7115301103, 7119931447, 7150162909, 7164563407, 7172093839, 7181458129, 7195768243, 7195879597, 7204174321, 7224234943, 7232307367, 7233504997, 7259859637, 7267393981, 7270435957, 7283988499, 7285667989, 7322593123, 7332239461, 7337197207, 7340257411, 7348851889, 7377902491, 7379843881, 7379958037, 7407397651, 7422201151, 7435638673, 7481605363, 7501304311, 7502672959, 7509773671, 7512234361, 7534426981, 7538367019, 7573358587, 7598339887, 7605698101, 7615487281, 7637903443, 7715902027, 7723050211, 7771693777, 7871732749, 7891177867, 7899811627, 7913548309, 7918210093, 7997383057, 8005229581, 8007344563, 8080350199, 8082725377, 8088738799, 8089610827, 8099198563, 8108165563, 8132445661, 8142167713, 8144027821, 8146077619, 8191430707, 8230139311, 8250602377, 8271620491, 8280083803, 8284990561, 8289601681, 8289980287, 8301233851, 8307551071, 8319325171, 8320180279, 8352097627, 8355355831, 8356819927, 8365319887, 8371156441, 8374692511, 8404168009, 8414163031, 8468895541, 8481708757, 8487577477, 8488044601, 8507076049, 8508476371, 8512185229, 8539929859, 8574963349, 8581438399, 8637441961, 8646699937, 8651253661, 8655328579, 8656833961, 8673473401, 8680363357, 8698527517, 8699815153, 8707824451, 8714838199, 8732675587, 8739044653, 8803441453, 8840861719, 8842778101, 8866138261, 8872452997, 8874770071, 8881565449, 8898174811, 8900452441, 8902198957, 8903359921, 8946605209, 8968816849, 8984001307, 9002661853, 9003240481, 9013732963, 9014594161, 9081365539, 9089935471, 9102093397, 9120879211, 9127051039, 9153262967, 9169361797, 9172596001, 9190638697, 9196596067, 9208725751, 9220829287, 9225194191, 9225213553, 9248053231, 9250672159, 9270770647, 9304717507, 9323685379, 9332895307, 9348732187, 9423252427, 9429232621, 9493925611, 9497600113, 9525613549, 9549650641, 9562805311, 9575362831, 9582840853, 9601071517, 9640484311, 9646800811, 9656616691, 9703686217, 9722321491, 9724333153, 9732502963, 9750056089, 9766325323, 9774995383, 9776371987, 9786968467, 9808505647, 9846469057, 9885797293, 9897262717, 9900956311, 9906890923, 9926136637, 10013721061, 10035343399, 10066000027, 10069595131, 10085700217, 10099212427, 10101292657, 10117936219, 10147105723, 10169645341, 10209387631, 10211633479, 10246814401, 10251916879, 10259812363, 10269476869, 10278360121, 10294798837, 10297183807, 10308213931, 10318191997, 10359064759, 10370500057, 10378430977, 10410394909, 10443006661, 10465392001, 10491158563, 10495681321, 10516271341, 10516352449, 10527823633, 10528866151, 10533095281, 10554557071, 10586654311, 10586886103, 10598948863, 10609230529, 10619296423, 10648628689, 10658810653, 10679244031, 10707952789, 10713861247, 10744985101, 10749403897, 10799640193, 10803560071, 10816400863, 10829607079, 10855871029, 10866381961, 10879385371, 10884680383, 10889237773, 10911430867, 10931342437, 10936972327, 10944512923, 10949084527, 10953085963, 10986146851, 10993114777, 11037912331, 11047621999, 11047637407, 11050727143, 11066958769, 11100377401, 11124665767, 11240322481, 11248717783, 11284257847, 11290054819, 11300502229, 11362128901, 11382810781, 11388695557, 11407304959, 11423801941, 11429063731, 11447388427, 11480698981, 11483151019, 11484791077, 11489467279, 11499794671, 11550118777, 11595346681, 11640494119, 11650187797, 11657981653, 11664294409, 11722832437, 11761485871, 11772646423, 11786382529, 11794422559, 11811151381, 11812373497, 11846832133, 11853119461, 11861373343, 11867772127, 11900691301, 11913756241, 11921845909, 11924641867, 11936587651, 11951397739, 11984005219, 11990256241, 12009696091, 12013380091, 12049256047, 12064517851, 12065458981, 12080413003, 12082862989, 12112882051, 12113636851, 12124936111, 12128666971, 12137522281, 12154718143, 12156588187, 12160211467, 12172636141, 12178554523, 12240886849, 12242348509, 12253395001, 12284315833, 12305186791, 12315158941, 12327839653, 12331729411, 12347107501, 12351082927, 12352067311, 12372461551, 12406574209, 12407202553, 12489970543, 12502410187, 12538837657, 12566533099, 12566581213, 12591979861, 12596464021, 12596888407, 12620219431, 12625535551, 12636931081, 12642867763, 12643237003, 12713344177, 12715681807, 12738343549, 12764857477, 12784190647, 12784522477, 12822841081, 12854010997, 12921494161, 12934149817, 12934839469, 12943145461, 12946519849, 12974595817, 12988236721, 12992283487, 13005804631, 13013980249, 13084198261, 13124850679, 13163690011, 13165882447, 13177652431, 13193391751, 13222195663, 13223354461, 13227151543, 13227709171, 13329362731, 13347365809, 13369110889, 13371396667, 13381890397, 13394946637, 13405484857, 13405520533, 13426351699, 13439181883, 13447894027, 13486938781, 13487859193, 13537269607, 13551454957, 13584189841, 13591882669, 13604786959, 13639110367, 13659430639, 13682537977, 13714781053, 13721611471, 13727546977, 13754799787, 13758894967, 13775873647, 13789716613, 13796090479, 13806865927, 13835094391, 13853808811, 13858651717, 13871679067, 13877805307, 13879645789, 13929785563, 13989408931, 14036753641, 14057876281, 14062231471, 14071985461, 14072051083, 14072614411, 14077816117, 14087307613, 14093547997, 14152605853, 14165802841, 14173642687, 14188480897, 14204597359, 14218278691, 14235550159, 14255581099, 14265500419, 14284116211, 14310269167, 14348069893, 14351112301, 14361533821, 14365030567, 14396424421, 14468468431, 14478325597, 14513172703, 14524459447, 14528283619, 14531904773, 14592233839, 14654154271, 14671357429, 14687583247, 14708272981, 14799223141, 14848465561, 14856207997, 14891372611, 14919338053, 14935589761, 14991369511, 15006090343, 15016346557, 15034889731, 15037389247, 15081460333, 15104206261, 15105751537, 15109405819, 15115297891, 15128184649, 15173568049, 15190480873, 15195838711, 15208104829, 15266317291, 15293502181, 15302542711, 15308062951, 15371337607, 15381663259, 15401437591, 15406265131, 15409288681, 15423373057, 15430994581, 15460625731, 15491720707, 15506367871, 15509428159, 15530729413, 15554878291, 15561996997, 15573241237, 15630922201, 15660716173, 15664568089, 15678541507, 15697134457, 15699070687, 15776834431, 15786131971, 15818275147, 15856299703, 15877240861, 15878462881, 15885514111, 15894585589, 15917169901, 15924374467, 15951598807, 15953983333, 15978607087, 15996524209, 16005086761, 16029003937, 16029672037, 16069551133, 16076673643, 16101954157, 16118154571, 16129824049, 16141210837, 16149727579, 16151466577, 16233282913, 16233651799, 16273862809, 16294311727, 16336697953, 16370882347, 16378059757, 16418569441, 16440720661, 16462337071, 16543244551, 16544489629, 16564930663, 16566017203, 16587880051, 16646736373, 16666752559, 16696449337, 16709199193, 16723399207, 16742018443, 16755532459, 16772685331, 16773313351, 16810420897, 16818335617, 16824158599, 16878591787, 16892655781, 16910329927, 16922818111, 16925228653, 16975621489, 17023982431, 17065513471, 17114996053, 17132167579, 17183421139, 17192363917, 17206678219, 17262461371, 17268978577, 17272048957, 17315595853, 17316094069, 17337495757, 17354089471, 17365100377, 17378059063, 17382138199, 17401399289, 17428586377, 17473848487, 17482566181, 17497443127, 17552172613, 17558546767, 17561596711, 17703961537, 17704480681, 17745079747, 17773433239, 17789404387, 17793825529, 17794246837, 17820389497, 17830420759, 17837607577, 17853101977, 17858522641, 17859951931, 17872005341, 17898672079, 17911899409, 17950255177, 17960059057, 18008703679, 18019029559, 18048622957, 18057263239, 18112705969, 18127225183, 18148179001, 18162769447, 18177508441, 18200024113, 18235999741, 18243874543, 18304502917, 18328783657, 18330321703, 18337573927, 18342433327, 18362920963, 18383412793, 18392115757, 18402344761, 18406128217, 18413459653, 18442501771, 18467190757, 18467530429, 18481627867, 18495100537, 18527779183, 18532486099, 18538473433, 18613927753, 18655151521, 18656455387, 18666577399, 18755558959, 18776030521, 18791531977, 18803367367, 18835809133, 18858661447, 18931560643, 18937411627, 18939468601, 18963495709, 19010746819, 19052208709, 19054884031, 19117570207, 19169935429, 19182615031, 19225004569, 19240268251, 19320681691, 19352427277, 19375280923, 19396628299, 19478899651, 19484182381, 19499850661, 19515894133, 19524508837, 19550469511, 19596820927, 19655139061, 19696474183, 19722106093, 19733794681, 19753881619, 19754956957, 19765431337, 19784035363, 19792411033, 19795196461, 19821836959, 19828304959, 19841301619, 19857662521, 19861690183, 19867704529, 19875961561, 19887302803, 19966484767, 19968856027, 20004018511, 20112873127, 20117968009, 20140155877, 20191179721, 20222796439, 20242108531, 20248929247, 20283826291, 20297417467, 20307658243, 20333233747, 20338610041, 20353872631, 20357648797, 20390871859, 20399973511, 20475774997, 20485336117, 20487042799, 20509528657, 20567016271, 20592021469, 20604346969, 20640420481, 20682968557, 20687721601, 20695861561, 20718784423, 20788350259, 20797138741, 20838378709, 20869859851, 20870119849, 20881752217, 20881908823, 20895363427, 20932132297, 20992004347, 20999158987, 21041366737, 21105391819, 21112778119, 21156354301, 21169644619, 21199987111, 21258536281, 21287544331, 21344468179, 21348695663, 21349604329, 21382609081, 21400053529, 21410168869, 21458656579, 21470341621, 21473812543, 21490105561, 21535436677, 21548074351, 21621067519, 21627093151, 21633492499, 21641418121, 21655360921, 21681950803, 21682620571, 21691071769, 21739367137, 21758251633, 21789130927, 21814775833, 21814868479, 21929211487, 21955278073, 21996021601, 22026636337, 22038555631, 22048657723, 22080920443, 22103157961, 22128023857, 22130955043, 22135548691, 22191114073, 22209315493, 22255904959, 22328544289, 22362248731, 22374257287, 22380340153, 22454043691, 22482606397, 22549044601, 22553952847, 22581885847, 22582710877, 22622900431, 22645153813, 22652019391, 22693646641, 22697754997, 22697928931, 22716698119, 22719058039, 22731517327, 22763044669, 22777106953, 22809094741, 22817698789, 22845140347, 22906661233, 22927984249, 23081588779, 23095250977, 23095310767, 23101100251, 23153659807, 23157250351, 23181615949, 23225204731, 23247577669, 23281735387, 23283707611, 23309354923, 23310468229, 23317703527, 23332051843, 23382664771, 23413473877, 23433046321, 23462343649, 23525773987, 23531086597, 23536073191, 23547689257, 23559645649, 23622444457, 23702437069, 23743741729, 23789080729, 23809671461, 23883389587, 23934314797, 23955361159, 23980226089, 24009244561, 24014600767, 24017426707, 24020476789, 24120312577, 24169693189, 24283970719, 24296608849, 24310072159, 24342846637, 24357336499, 24367139149, 24481878919, 24525697099, 24576591163, 24598023997, 24642168673, 24702897019, 24760891579, 24762449671, 24776949667, 24794990029, 24803417269, 24856367143, 24860759683, 24869353237, 24984810913, 24996615997, 25059443179, 25068251503, 25084450669, 25088242999, 25090276117, 25097853691, 25140900847, 25202092957, 25213951621, 25281868459, 25298911867, 25370187277, 25400087389, 25401563389, 25436437297, 25447339273, 25457509183, 25463413207, 25470214111, 25474108819, 25498694311, 25502391643, 25565863747, 25582358101, 25615920163, 25618488769, 25711856857, 25739454547, 25746698053, 25778808577, 25847672467, 25889662021, 26028737113, 26097739249, 26134348909, 26192408467, 26194133857, 26201920627, 26230350847, 26244820993, 26360369491, 26415462571, 26432931643, 26454101017, 26462643439, 26484380077, 26489532343, 26506088617, 26515941061, 26521481209, 26546352187, 26616207451, 26618181169, 26666659111, 26672760031, 26721766921, 26726605903, 26749471897, 26827195951, 26869348867, 26906039917, 26977850563, 26982449239, 26999041669, 27021728137, 27031765027, 27035654143, 27072137959, 27091918057, 27118755217, 27122408041, 27146433577, 27150871171, 27163386139, 27176197231, 27210810901, 27242208577, 27243452791, 27246442981, 27274185793, 27381617971, 27412514221, 27594790159, 27600338191, 27650652691, 27659453971, 27669270217, 27686408107, 27757965901, 27831077509, 27864442831, 27880127941, 27924266119, 27969358603, 28005178783, 28052093317, 28081015771, 28133636647, 28168554487, 28170577507, 28199968429, 28200978049, 28226970067, 28250857777, 28375746043, 28382386537, 28400008279, 28403383681, 28406111917, 28458676237, 28491319687, 28546135231, 28562841763, 28604315251, 28617237841, 28680221389, 28746720661, 28768431847, 28868303179, 28883168467, 28892844121, 29003535949, 29121563659, 29152879627, 29201143243, 29255388511, 29261198191, 29264320177, 29342693101, 29361390169, 29407712041, 29428945729, 29466693049, 29600711011, 29635545451, 29707583287, 29709553147, 29725666237, 29729281963, 29847839971, 29871707191, 29879645827, 29882208163, 29885232109, 29890989697, 29908519057, 30002761741, 30011510803, 30052083631, 30066710701, 30095610007, 30099872749, 30123765967, 30178515361, 30184297987, 30211007599, 30216268399, 30249591037, 30259449247, 30327378241, 30348803161, 30379268893, 30392375371, 30396423091, 30421416127, 30465115027, 30471940591, 30487433167, 30502627879, 30515488021, 30642831319, 30646147621, 30650577511, 30714241951, 30742166029, 30754742779, 30778569109, 30841163767, 30850817089, 30893241667, 30907677847, 30968864599, 31068892531, 31084346971, 31132674337, 31248797851, 31283737087, 31287116911, 31313410573, 31379161963, 31389443887, 31389882571, 31416774889, 31444376071, 31465965757, 31480358323, 31507758769, 31575927451, 31609192441, 31674243847, 31848568231, 31860383341, 31945825297, 31960025113, 32035444951, 32059381327, 32059963471, 32113526719, 32161445347, 32161909453, 32197520473, 32253590821, 32286012721, 32346797953, 32364377137, 32376395353, 32391842341, 32467563871, 32471061043, 32503075879, 32546215363, 32570032207, 32650493611, 32686144753, 32719089343, 32735218279, 32746144999, 32752860631, 32773422217, 32776350331, 32894986219, 32911498573, 32951812981, 33003284593, 33004414483, 33177741439, 33185761771, 33202747393, 33321333781, 33325921381, 33359029321, 33363168439, 33396619621, 33402416557, 33446451403, 33476953441, 33509456941, 33529031329, 33531093361, 33558454399, 33564701371, 33769566451, 33772834813, 33778700509, 33797176429, 33815268967, 33974673853, 34024992877, 34053070507, 34058378143, 34085630191, 34090063507, 34127560861, 34166008801, 34222741129, 34225477861, 34325616613, 34347469591, 34395324961, 34406811643, 34422232183, 34446221863, 34464835417, 34510733419, 34575170977, 34607061409, 34641546943, 34659121499, 34660830397, 34677518779, 34713345829, 34759933069, 34769264911, 34799356489, 34802737789, 34880134291, 34936195057, 34936263643, 34979561527, 35017315483, 35092448581, 35177544949, 35188343989, 35195929339, 35256097897, 35286174331, 35481338257, 35488217857, 35534469739, 35569927201, 35596717573, 35618632141, 35628468331, 35688537751, 35722238437, 35735863567, 35759769889, 35850484693, 35865275863, 35884242283, 35923390651, 35957128819, 36008374081, 36029263297, 36037029289, 36044541271, 36057406477, 36071974849, 36104437867, 36110760271, 36124155913, 36139806127, 36144309559, 36163594939, 36259471141, 36268432699, 36271162591, 36307838911, 36327019831, 36415854091, 36427558987, 36476661253, 36533003071, 36540394351, 36566243401, 36611681089, 36618814849, 36722453743, 36724449637, 36740228251, 36759021883, 36761974591, 36796985509, 36884511931, 36886607161, 36906559357, 36952540717, 36973873957, 36986440453, 36993279937, 37013386447, 37016335507, 37085744587, 37154360437, 37209734059, 37237870489, 37243368121, 37281104491, 37281224011, 37350557701, 37363676767, 37438695121, 37533721387, 37542020491, 37642262431, 37650385777, 37659033103, 37690536937, 37749112909, 37810086511, 37873298521, 37876582201, 37892851807, 37944348961, 37975609813, 37982206501, 37998380317, 38143269793, 38150610871, 38173755343, 38214197083, 38250070717, 38270398261, 38298372319, 38308463707, 38414805241, 38498915641, 38526401803, 38578378567, 38590312027, 38603175151, 38614676647, 38631677701, 38697399967, 38708526781, 38746381879, 38773118047, 38782650547, 38851855351, 38910222697, 38949640141, 38969714491, 39013864261, 39309306457, 39343467997, 39346073257, 39487577179, 39504753751, 39514147879, 39539115277, 39604439689, 39612774433, 39635475853, 39692094031, 39725677447, 39730504603, 39752436799, 39757100143, 39763604371, 39788588227, 39813366811, 39842000563, 39852780973, 39853943617, 39870430627, 39901550287, 39928904311, 39948177361, 39965681029, 39972019567, 40057807567, 40104600043, 40128472147, 40150684681, 40165877371, 40180067383, 40202762671, 40238547259, 40244075629, 40253531683, 40271314441, 40371933271, 40438030051, 40582237999, 40608133399, 40842392011, 40865945401, 40873437571, 40880890441, 40902926131, 40927749727, 40940055703, 40940267923, 40955154631, 40982590279, 41016268651, 41045668987, 41074169527, 41180126557, 41248620337, 41255678227, 41255863897, 41276479801, 41345583259, 41350915429, 41392945147, 41404619017, 41409580063, 41496393901, 41501196283, 41515154671, 41516332327, 41516916421, 41558513251, 41588761303, 41639288161, 41655184651, 41712694987, 41728069501, 41738920357, 41745890551, 41765268709, 41810602891, 42091972807, 42107272969, 42111630247, 42198167449, 42246877873, 42278330797, 42302410231, 42313206217, 42338837227, 42496036789, 42520732591, 42643698007, 42722367241, 42750117427, 42755135359, 42805123159, 42827253457, 42839278357, 42843577729, 42866549041, 42885706261], "chunkSize": 1000000, "N": 200000000000}'

def squareFreeGen(N, primes, ixStart):
    # Generates square free numbers less than or equal to N from primes
    for ix in range(ixStart, len(primes)):
        p = primes[ix]
        phi = p-1
        if p > N: break
        yield p,phi
        for sf,sfphi in squareFreeGen(N//p, primes, ix+1):
            yield p*sf, phi*sfphi
        
def Euler245(N):
    primes = MakePrimeList(10**7)
    solutions = set()
    for sf, sfphi in squareFreeGen(N, primes, 1):
        if sfphi+1 == sf: continue
        if (sf - 1) % (sf - sfphi) == 0:
            solutions.add((sf,sfphi))
    sols = list(solutions)
    sols.sort()
    for s in sols:
        print s
    return sum(s[0] for s in solutions)
    
if __name__ == '__main__':
    try:
        cuff = CoresilienceUnitFractionFinder(100, 10**6)
        cuff.resumeFromSave()
    except KeyboardInterrupt:
        cuff.save()